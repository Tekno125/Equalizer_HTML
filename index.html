<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Audio Equalizer with Custom Presets and Table Layout</title>
<style>
  body {
    font-family: Arial, sans-serif;
    background: #121212;
    color: #eee;
    margin: 20px;
    display: flex;
    flex-direction: column;
    align-items: center;
  }
  h1 {
    margin-bottom: 10px;
  }
  #upload-container {
    margin-bottom: 10px;
    text-align: center;
  }
  audio {
    width: 100%;
    max-width: 600px;
    margin-bottom: 20px;
    outline: none;
  }
  .controls {
    margin-bottom: 20px;
    display: flex;
    align-items: center;
    gap: 15px;
    flex-wrap: wrap;
    justify-content: center;
  }
  select, button {
    padding: 8px 12px;
    font-size: 1rem;
    cursor: pointer;
    border-radius: 5px;
    border: none;
  }
  select {
    background: #333;
    color: #eee;
  }
  button {
    background: #5fbf5f;
    color: #121212;
  }
  table.equalizer-table {
    border-collapse: collapse;
    width: 90vw;
    max-width: 700px;
    table-layout: fixed;
  }
  table.equalizer-table th,
  table.equalizer-table td {
    padding: 5px 3px;
    text-align: center;
    vertical-align: middle;
  }
  table.equalizer-table th {
    font-size: 13px;
    user-select: none;
    white-space: nowrap;
  }
  input[type=range] {
    -webkit-appearance: none;
    width: 30px;
    height: 150px;
    background: #222;
    border-radius: 5px;
    writing-mode: vertical-lr;
    direction: rtl;
    cursor: pointer;
    margin: auto;
    display: block;
  }
  input[type=range]::-webkit-slider-thumb {
    -webkit-appearance: none;
    appearance: none;
    width: 24px;
    height: 24px;
    background: #5fbf5f;
    border-radius: 50%;
    border: 1.5px solid #333;
    cursor: pointer;
  }
  input[type=range]::-moz-range-thumb {
    width: 24px;
    height: 24px;
    background: #5fbf5f;
    border-radius: 50%;
    border: 1.5px solid #333;
    cursor: pointer;
  }
  .gain-value {
    font-size: 12px;
    color: #a0d8a0;
    user-select: none;
    margin-top: 3px;
  }
  @media (max-width: 480px) {
    table.equalizer-table {
      width: 100%;
    }
    input[type=range] {
      height: 120px;
      width: 25px;
    }
    .controls {
      flex-direction: column;
      gap: 10px;
    }
  }
table.equalizer-table {
  border-collapse: collapse;
  width: auto;          /* Sesuaikan lebar dengan isi masing-masing kolom */
  max-width: 100%;      /* Maksimum lebar tidak melebihi container */
  table-layout: auto;   /* Otomatis mengatur lebar kolom sesuai isi */
  white-space: nowrap;  /* Label tidak terbungkus ke baris baru */
}

.equalizer-table th,
.equalizer-table td {
  padding: 5px 6px;
  text-align: center;
  vertical-align: middle;
}

.equalizer-table th {
  font-size: 13px;
  user-select: none;
  white-space: nowrap;  /* Label hanya satu baris */
  overflow: hidden;
  text-overflow: ellipsis;  /* Potong teks dengan ... jika terlalu panjang */
  max-width: 60px;          /* Lebar kolom dibatasi agar rapi */
}

input[type=range] {
  margin: auto;
  display: block;
  height: 150px;
  width: 30px;
  min-width: 30px;
  max-width: 30px;
  background: #222;
  border-radius: 5px;
  writing-mode: vertical-lr;
  direction: rtl;
  cursor: pointer;
}

</style>
</head>
<body>
<h1>Audio Equalizer with Custom Presets and Table Layout</h1>
<div id="upload-container">
  <input type="file" id="audio-file" accept="audio/*" />
</div>
<audio id="audio" controls></audio>

<div class="controls">
  <label for="preset-select">Preset Equalizer:</label>
  <select id="preset-select" title="Select Equalizer Preset">
    <option value="flat">Flat</option>
    <option value="bass_boost">Bass Boost</option>
    <option value="vocal_presence">Vocal / Presence</option>
    <option value="rock_vshape">Rock (V-shape)</option>
    <option value="classical_clarity">Classical / Clarity</option>
  </select>
  <button id="reset-btn" title="Reset Equalizer">Reset</button>
</div>

<table class="equalizer-table" aria-label="Audio equalizer controls">
  <thead>
    <tr id="labels-row">
      <!-- Labels inserted by JS -->
    </tr>
  </thead>
  <tbody>
    <tr id="sliders-row">
      <!-- Sliders inserted by JS -->
    </tr>
    <tr id="gain-row">
      <!-- Gain values inserted by JS -->
    </tr>
  </tbody>
</table>

<script>
  const bands = [
    { name: "Sub-Bass", freq: 60 },
    { name: "Bass", freq: 170 },
    { name: "Low-Mid", freq: 310 },
    { name: "Mid", freq: 600 },
    { name: "Upper-Mid", freq: 1000 },
    { name: "Presence", freq: 3000 },
    { name: "Upper-Presence", freq: 6000 },
    { name: "Treble", freq: 12000 },
    { name: "Brilliance", freq: 14000 },
    { name: "Air", freq: 16000 }
  ];

  const presets = {
    flat:         [0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
    bass_boost:   [6, 4, 2, 0, 0, -1, -2, -2, -2, -2],
    vocal_presence: [-2, -1, 0, 1, 3, 3, 1, 0, 0, -1],
    rock_vshape:  [5, 3, 0, -1, -1, 2, 3, 4, 4, 3],
    classical_clarity: [-1, 0, 1, 2, 2, 1, 1, 2, 1, 1]
  };

  const labelsRow = document.getElementById('labels-row');
  const slidersRow = document.getElementById('sliders-row');
  const gainRow = document.getElementById('gain-row');

  const audioFileInput = document.getElementById('audio-file');
  const audio = document.getElementById('audio');
  const presetSelect = document.getElementById('preset-select');
  const resetBtn = document.getElementById('reset-btn');

  const AudioContext = window.AudioContext || window.webkitAudioContext;
  const audioCtx = new AudioContext();
  let sourceNode = null;

  const filters = bands.map(band => {
    const filter = audioCtx.createBiquadFilter();
    filter.type = 'peaking';
    filter.frequency.value = band.freq;
    filter.Q.value = 1.4;
    filter.gain.value = 0;
    return filter;
  });

  for(let i = 0; i < filters.length - 1; i++) {
    filters[i].connect(filters[i + 1]);
  }

  const sliders = [];
  const gainValues = [];

  // Populate table header and body rows
  bands.forEach((band, i) => {
    // Label cell
    const th = document.createElement('th');
    th.textContent = `${band.name}\n${band.freq} Hz`;
    labelsRow.appendChild(th);

    // Slider cell
    const tdSlider = document.createElement('td');
    const slider = document.createElement('input');
    slider.type = 'range';
    slider.min = -12;
    slider.max = 12;
    slider.step = 0.1;
    slider.value = 0;
    slider.title = `Gain ${band.freq} Hz`;
    slider.style.margin = "auto";
    tdSlider.appendChild(slider);
    slidersRow.appendChild(tdSlider);

    // Gain value cell
    const tdGain = document.createElement('td');
    tdGain.className = 'gain-value';
    tdGain.style.textAlign = 'center';
    tdGain.textContent = slider.value + ' dB';
    gainRow.appendChild(tdGain);

    slider.addEventListener('input', e => {
      filters[i].gain.value = e.target.value;
      tdGain.textContent = parseFloat(e.target.value).toFixed(1) + ' dB';
      updatePresetSelection();
    });

    sliders.push(slider);
    gainValues.push(tdGain);
  });

  function applyPreset(name) {
    const gains = presets[name];
    sliders.forEach((slider, i) => {
      slider.value = gains[i];
      filters[i].gain.value = gains[i];
      gainValues[i].textContent = gains[i].toFixed(1) + ' dB';
    });
  }

  function updatePresetSelection() {
    const currentGains = sliders.map(slider => parseFloat(slider.value));
    let matchedPreset = null;
    for(const key in presets) {
      const gains = presets[key];
      if(gains.length === currentGains.length &&
         gains.every((v, i) => Math.abs(v - currentGains[i]) < 0.15)) {
        matchedPreset = key;
        break;
      }
    }
    if(matchedPreset) {
      presetSelect.value = matchedPreset;
    } else {
      presetSelect.value = '';
    }
  }

  presetSelect.addEventListener('change', e => {
    if(e.target.value) {
      applyPreset(e.target.value);
    }
  });

  resetBtn.addEventListener('click', () => {
    applyPreset('flat');
    presetSelect.value = 'flat';
  });

  audioFileInput.addEventListener('change', () => {
    const files = audioFileInput.files;
    if(files.length === 0) return;
    const file = files[0];
    const fileURL = URL.createObjectURL(file);
    audio.src = fileURL;

    if(sourceNode) {
      sourceNode.disconnect();
      sourceNode = null;
    }

    audio.onplay = () => {
      if(!sourceNode) {
        sourceNode = audioCtx.createMediaElementSource(audio);
        sourceNode.connect(filters[0]);
        filters[filters.length -1].connect(audioCtx.destination);
      }
      if(audioCtx.state === 'suspended') {
        audioCtx.resume();
      }
    };
  });

  applyPreset('flat');
  presetSelect.value = 'flat';
</script>
</body>
</html>
